这次是和zxy一起合作完成的一个开眼视频app，我负责的是home,square,video三个模块。

## module_home

![](/首页.gif)

主框架是用的VP2+Fragment的形式，采用的协调者布局，在rv滑动时会隐藏底部导航栏。home界面则是同样的VP2+Fragment的形式，这里解决了内层vp2和外层vp2的滑动冲突（采用的是在内层vp2的外面包了一个layout），但是如果快速滑动（如fling）时，判断会失效(canScroll..的问题),暂时不知道如何解决。

日报和推荐界面都是一个大的RV,把标题，视频，小视频的样式全部塞到rv里面并重写了不同的类型所展示的item，点击后可以跳转到视频界面。这个界面采用的是协程+paging3的网络请求方式，能更丝滑的加载数据。

## module_video

![](/视频.gif)

视频播放界面，在接受一大堆参数后（这里被学长批评了，应该把数据类放到base模块然后用序列化的形式进行传输的，我使用了最笨的办法一个一个传输）,能跳转到这个界面，顶部是一个视频播放器，我使用的是GSYVideoPlayer，一开始是觉得比较好看就用了这个，后面发现有个问题就是如果在播放中途退出了后，有概率会发生内存泄漏，查看小黄鸟后猜测是内部加载视频时调用了ConnectiveManager来不断检查网络是否链接，退出时导致的内存泄漏（文档里没有提到这个，故暂不知道如何解决）。下面是一个TabLayout+Fragment,分为简介和评论界面。评论界面就是能查看最新评论和最热评论两种类型，使用paging3+协程加载，详情页也是做成了一个大的rv，顶部就是一些简介，下面是推荐相关视频，通过ConcatAdapter进行链接。

然后自己写了一个下拉刷新界面，主要使用的是嵌套滑动，layout继承了NestedScrollParent2,与rv有一个比较好的联动，下拉时也用了大量的动画（比如下拉时根据滑动的距离旋转图标，以及释放后的一个回弹效果）来模拟一个比较好的效果，然后向外暴露动画开始/结束的接口。

## module_square

![](广场.gif)

![](广场详情.gif)

首先是广场页，这里也是一个大的rv用ConcatAdapter进行链接，顶部是一个banner，用RxJava+Livedata进行网络请求，用Handler+Runnable实现了自动滑动和手动滑动的一个效果，这里在adapter里面还对内存泄漏进行了处理，去除了handler导致的内存泄漏的可能(用的是在生命周期进行处理)，然后重写了PageTransformer达到了一个比较好看的banner动画效果。下面也是用的rv，使用瀑布流看着更美观，然后用的RxJava+Livedata,通过对rv的监听实现了一个简单的无限加载，这里不用paging3是因为进入详情页时需要将整个list传进去所以手动实现，便于维护。

这里跳转时就用的Parcelable序列化的形式进行传递参数。

广场详情页，就是竖着的vp2+横着的vp2的形式，能够查看当前的内容的所有图片以及已经加载好的图片，然后为了查看详情时能不影响图片的查看，故模拟了BottomDialog的样式，点击按钮时进行弹出，然后对高度进行一些计算，按比例缩小上面的图片，实现一个相对丝滑的效果。（偷了个懒，没有写这个底部dialog的滑动）。

## 使用的技术栈

- 协程+paging3/RxJava+livedata的网络请求
- MVVM框架
- 运用事件分发处理了滑动冲突
- 自定义的嵌套滑动
- 动画的使用

## 不足的地方

- 滑动冲突处理的地方不够完善
- 内存泄漏意识还不够（每次都是泄漏一堆后再去解决😂）
- 知识储备不够，一些想实现的效果要到处查资料现学
- 代码不够规范，被学长喷说写的jatlin（尽量的改了）

## 心得体会

在红岩学习也快一年了，在学长的指导以及自己的努力下，现在还是能写出一个稍微像样的app，这个过程即艰辛又快乐，有时会遇到一堆不知道怎么解决的bug以及一堆看不懂的知识，到最后解决出来的畅快，使我收益颇丰，学到了许多技术以及知识，当然我觉得最重要的在这一年中，我能逐渐明确自己的目标，不再毫无目的的学习。虽然现在仅仅是学了一些很简单的知识，包括源码以及更深的技术都没有进行学习，相信我在明确自己的目标后能不断进一步学习，提升自己。

感谢自己能在大一遇到红岩以及红岩这么多优秀的学长，希望自己后面能以学长为榜样不断进步!